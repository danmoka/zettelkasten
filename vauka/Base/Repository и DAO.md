21112022 1349
Tags: #z #dev 

---
# Паттерны Repository и DAO

## DAO

С помощью Data Access Object паттерна можно создать объект для работы с хранилищем и данными.

Основные идеи для чего нужен такой объект:
- абстракция над состоянием данных
- организует работу с хранилищем данных (неважно является ли хранилище базой данных или удаленным сервером)
- реализует базовый интерфейс для работы с сущностью (создание, обновление, удаление, получение)
- 1 DAO - 1 сущность
- скрывает сложный комплекс SQL или HTTP (или ORM?) запросов
- является "глупым", не должен зависеть от бизнес задач

## Repository

С помощью данного паттерна можно создать объект для работы с сущностями как с коллекцией.

Основные идеи:
- может использовать DAO внутри себя
- определяет методы для работы с сущностями как с коллекцией данных (добавить в коллекцию, удалить из коллекции, обновить сущность в коллекции, найти элемент коллекции)
- не думает о том, где и как хранятся данные
- более приближен к сущности и работе с ней (например, создание профиля требует создания базовых прав для пользователя, а значит требуется использовать DAO профиля и DAO прав, т.е. требуется выполнить комплекс действий, а не просто "создать" профиль)


## Вывод

- DAO - смотрит на сущность как на объект в хранилище данных
- Repository - смотрит на сущность как на объект в коллекции
- Repository может работать с несколькими DAO для реализации комплексных действий над сущностью
- Repository - похож на DAO, если в Repository реализуется простой набор действий с сущностью
- Repository похож на огромный неповоротливый черный ящик, если содержит много бизнес-правил (простое добавление профиля может выполнять кучу действий: создать email, создать права, добавить дефолтные подписки и т.д., что лучше вынести на уровень сервисов)
- нужно найти баланс: DAO делает свою работу, Repository свою, а сервисы свою
- Repository и DAO исторически название одного и того же только в разных компаниях (Microsoft, Sun)
- Возможно увеличение запросов к БД, если не определен механизм хранения запросов к БД в памяти и выполнения пачки запросов "за раз"
- Repository ориентируется на предметную область, а не сложные запросы в хранилище, что упрощает работу с данными для членов команды
- зона ответственности сущности (модели данных) - описать хранимые данные
- зона ответственности DAO - уметь сохранить, обновить и т.д. сущность в хранилище (удаленном сервере)
- зона ответственности Repository - организовать работу с сущностью исходя из требований

## Вопросы

- Что есть ORM - это DAO? Repository?
- Можно ли создать Repository, а внутри использовать ORM? Тем самым, у нас как-бы готов объект для доступа к данным, а значит можно сосредоточиться на логике работы с сущностью (скрыть запросы к ORM простым, торчащим наружу, методом profile_repository.add_profile)

## Реализация

Реализация на языке C#:
- использование контекста БД для подключения к хранилищу
- использование EntityFramework (аналог Django ORM)
- использование репозиториев для каждой сущности (похоже на правило 1 сущность - 1 DAO, исторический отголосок просто разных названий для одного и того же)
- использование обертки над репозиториями для упрощенного доступа к ним, а так же выполнения нескольких запросов за раз
- репозиторий использует EntityFramework в качестве доступа к основной сущности и сущностям, которые с ней связаны
- обертка репозитория использует репозитории и контекст БД


---
### Zero-Links
- [[00 Паттерны]]

---
### Links
- 

---
### Outer links
- https://habr.com/ru/post/263033/
- https://www.baeldung.com/java-dao-vs-repository
- https://stackoverflow.com/questions/8550124/what-is-the-difference-between-dao-and-repository-patterns
- https://thinkinginobjects.com/2012/08/26/dont-use-dao-use-repository/