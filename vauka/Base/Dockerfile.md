03032023 1236
Tags: #z #dev

---
# Dockerfile

Dockerfile - это файл с инструкциями по сборке образа. Docker использует эту информацию для создания образов. Dockerfile сообщает информацию о том какие слои и в каком порядке должны добавлены в образ.

## Инструкции

Каждая инструкция состоит из заглавных букв, далее следуют аргменты инструкции.
Инструкции, которые создают слои:
- FROM - задает базовый образ
- RUN - выполняет команду и создает слой образа
- COPY - копирует в контейнер файлы и папки
- ADD - копирует в контейнер файлы и папки, может распаковывать `.tar`

Остальные инструкции:
- ENV - задает постоянные переменные среды
- CMD - описывает команду, которая должна быть выполнена при запуске контейнера (может быть только одна инструкция CMD)
- WORKDIR - задает рабочую директорию для следующей инструкции
- ENTRYPOINT - предоставляют команду с аргументами для вызова во время выполнения контейнера
- EXPOSE - указывает на необходимость открыть порт
- VOLUME - задает точку монтирования для работы с постоянным хранилищем


### RUN

Инструкция RUN используется для выполнения команд. Например, команд по обновлению пакетов образа. После выполнения команды создаётся новый слой в образе. Формат команды для инструкции RUN: exec или shell форма.

```dockerfile
RUN apk update && apk upgrade && apk add bash
```

```dockerfile
RUN ["mkdir", "/new_dir"]
```


### COPY

Копирует файлы и папки из текущего контекста сборки в папки в образе.

```dockerfile
COPY . ./app
```

### CMD

Инструкция CMD выполняет команду при запуске контейнера. Это может быть команда для выполнения исполняемого файла. Команда может быть записана в exec формате. Инструкция CMD может быть только одна (все, кроме последней, игнорируются). Аргументы командной строки, передаваемыке `docker run` при запуске контейнера, переопределяют аргументы, предоставляемые инструкции CMD.

```dockerfile
CMD ["python", "./manage.py"]
```

>[!note] Не устанавливаются пакеты python
>Скорее всего на предыдущем слое надо было обновить пакеты образа и установить пакетный менеджер pip

### WORKDIR

Данная инструкция позволяет изменить рабочую директорию. Лучше указывать абсолютный путь, а не перемещаться с помощью команд `cd`. Если данной папки нет, то инструкция её создаст.

### ENTRYPOINT

Инструкция ENTRYPOINT позволяет задать команду, которая выполнится во время запуска контейнера.  В отличие от CMD, аргументы ENTRYPOINT нельзя изменить во время выполнения команды `docker run`.
Рекомендации, что использовать:
- при запуске контейнеров используется одна и таже команда - ENTRYPOINT;
- контейнер используется в роли приложения - ENTRYPOINT;
- при запуске требуется передать аргументы - CMD.

```dockerfile
ENTRYPOINT ["python", "./manage.py", "size"]
```

Значение, представленное аргументом size, должно быть заранее задано, например, с помощью инструкции ARG. Используя инструкцию ARG, можно передавать аргументы при запуске, тем самым изменяя передаваемое значение аргумента в инструкцию ENTRYPOINT.

### VOLUME

Позволяет указать место, которое будет использовано для постоянного хранения файлов и для работы с ними.

---
### Zero-Links
- [[00 Docker]]

---
### Links
- 

---
### Outer links
- https://habr.com/ru/company/ruvds/blog/439980/