22092022 1424
Tags: #z #dev

---
# Параллельные планы

Обычный план нельзя запустить выполняться параллельно. Это цельный кусок. Каждый процесс от начала и до конца выполнит его и выдаст одинаковый результат. Для этого надо использовать параллельный план, который состоит из частей. Каждую часть выполнит параллельный процесс и выдаст нужные данные по своей части.

## Параллельное сканирование

Целевая таблица разбивается на блоки отношений. Каждый блок сканируется параллельным процессом. После сканирования процесс переходит к следующему блоку.

## Параллельное агрегирование

Процессы выполнят агрегирование на блоке данных. Затем ведущий блок выполняет агрегирование на результатах агрегирования процессов. Если количество групп при агрегировании приближено к количеству строк, то применение параллельного агрегирования маловероятно.

Не используется, если агрегатная функция задействует предложения *ORDER BY, DISTINCT, GROUPING SETS*.

## Советы

Если параллельный план не строится, можно попробовать уменьшить parallel_setup_cost или parallel_tuple_cost. При этом может оказаться, что последовательное выполнение окажется быстрее.

---
### Zero-Links
- 

---
### Links
- [[Применение параллельных запросов (pgsql)]]